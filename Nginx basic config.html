<!-- build time:Wed Sep 11 2019 16:17:23 GMT+0800 (GMT+08:00) --><!doctype html><html class="theme-next mist" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta name="google-site-verification" content="7Tau9WyVgxnsEY9oYedu9g0U6_8akOX3wiKbaYcrg9A"><meta name="baidu-site-verification" content="EVwLiaxdxX"><link href="/css/animsition.min.css" rel="stylesheet" type="text/css"><link href="/css/xps13.css" rel="stylesheet" type="text/css"><link href="/css/message.css" rel="stylesheet" type="text/css"><script type="text/javascript" src="/js/jquery-1.11.3.min.js"></script><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css"><meta name="keywords" content="Nginx,"><link rel="alternate" href="/atom.xml" title="MrBird" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1"><meta name="description" content="Nginxé…ç½®æ–‡ä»¶ä¸»è¦åˆ†æˆå››éƒ¨åˆ†ï¼šmainï¼ˆå…¨å±€è®¾ç½®ï¼‰ã€httpï¼ˆHTTPçš„é€šç”¨è®¾ç½®ï¼‰ã€serverï¼ˆè™šæ‹Ÿä¸»æœºè®¾ç½®ï¼‰ã€locationï¼ˆåŒ¹é…URLè·¯å¾„ï¼‰ã€‚è¿˜æœ‰ä¸€äº›å…¶ä»–çš„é…ç½®æ®µï¼Œå¦‚eventï¼Œupstreamç­‰ã€‚ä¸€ä¸ªå®Œæ•´çš„Nginxé…ç½®å¦‚ä¸‹ï¼š"><meta name="keywords" content="Nginx"><meta property="og:type" content="article"><meta property="og:title" content="Nginxçš„åŸºæœ¬é…ç½®"><meta property="og:url" content="http://mrbird.cc/Nginx basic config.html"><meta property="og:site_name" content="MrBird"><meta property="og:description" content="Nginxé…ç½®æ–‡ä»¶ä¸»è¦åˆ†æˆå››éƒ¨åˆ†ï¼šmainï¼ˆå…¨å±€è®¾ç½®ï¼‰ã€httpï¼ˆHTTPçš„é€šç”¨è®¾ç½®ï¼‰ã€serverï¼ˆè™šæ‹Ÿä¸»æœºè®¾ç½®ï¼‰ã€locationï¼ˆåŒ¹é…URLè·¯å¾„ï¼‰ã€‚è¿˜æœ‰ä¸€äº›å…¶ä»–çš„é…ç½®æ®µï¼Œå¦‚eventï¼Œupstreamç­‰ã€‚ä¸€ä¸ªå®Œæ•´çš„Nginxé…ç½®å¦‚ä¸‹ï¼š"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http://mrbird.cc/img/mrbird_pohto_20171101114239.png"><meta property="og:image" content="http://mrbird.cc/img/mrbird_photo_20171101112838.png"><meta property="og:image" content="http://mrbird.cc/img/mrbird_photo_20171101151244.png"><meta property="og:image" content="http://mrbird.cc/img/QQæˆªå›¾20171101151332.png"><meta property="og:image" content="http://mrbird.cc/img/QQæˆªå›¾20171101151521.png"><meta property="og:image" content="http://mrbird.cc/img/QQæˆªå›¾20171101151607.png"><meta property="og:image" content="http://mrbird.cc/img/QQæˆªå›¾20171101151711.png"><meta property="og:updated_time" content="2019-07-12T13:02:30.489Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Nginxçš„åŸºæœ¬é…ç½®"><meta name="twitter:description" content="Nginxé…ç½®æ–‡ä»¶ä¸»è¦åˆ†æˆå››éƒ¨åˆ†ï¼šmainï¼ˆå…¨å±€è®¾ç½®ï¼‰ã€httpï¼ˆHTTPçš„é€šç”¨è®¾ç½®ï¼‰ã€serverï¼ˆè™šæ‹Ÿä¸»æœºè®¾ç½®ï¼‰ã€locationï¼ˆåŒ¹é…URLè·¯å¾„ï¼‰ã€‚è¿˜æœ‰ä¸€äº›å…¶ä»–çš„é…ç½®æ®µï¼Œå¦‚eventï¼Œupstreamç­‰ã€‚ä¸€ä¸ªå®Œæ•´çš„Nginxé…ç½®å¦‚ä¸‹ï¼š"><meta name="twitter:image" content="http://mrbird.cc/img/mrbird_pohto_20171101114239.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",sidebar:{position:"left",display:"always",offset:12,offset_float:0,b2t:!1,scrollpercent:!1},fancybox:!1,motion:!1}</script><title>Nginxçš„åŸºæœ¬é…ç½® | MrBird</title></head><body ondragstart="return!1" class="animsition" lang="zh-Hans" style="overflow-x:hidden;padding-right:280px"><script type="text/javascript" src="/js/animsition.min.js"></script><script type="text/javascript" src="/js/mo.min.js"></script><script>$("body").animsition({inClass:"fade-in",outClass:"fade-out",inDuration:300,outDuration:300,linkElement:".animsition-link",loading:!0,loadingParentElement:"html",loadingClass:"line-scale-pulse-out",loadingInner:"",timeout:!1,timeoutCountdown:50,onLoadEvent:!0,browser:["animation-duration","-webkit-animation-duration"],overlay:!1,overlayClass:"animsition-overlay-slide",overlayParentElement:"html",transition:function(n){window.location.href=n}})</script><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><link href="https://fonts.font.im/css?family=Merienda" rel="stylesheet"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title" style="font-family:Merienda;font-size:1.3rem">MrBird</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section">HOME</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section">ARCHIVES</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section">TAGS</a></li><li class="menu-item menu-item-friends"><a href="/friends/" rel="section">FRIENDS</a></li><div class="sidebar-toggle" style="display:none"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="Search" spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div><div class="header-inner"><div class="note info" style="margin:0;letter-spacing:.15px">ğŸ¤æ‰‹æŠŠæ‰‹æ•™ä½ æ­å»º<strong>å¾®æœåŠ¡æƒé™ç³»ç»Ÿ</strong>ï¼ˆä»é›¶åˆ°éƒ¨ç½²ï¼‰ï¼š<a style="color:#40dab2;font-weight:600" href="https://www.kancloud.cn/mrbird/spring-cloud" target="_blank">https://www.kancloud.cn/mrbird/spring-cloud</a></div></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://mrbird.cc/Nginx basic config.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="MrBird"><meta itemprop="description" content=""><meta itemprop="image" content="/images/blogImage.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="MrBird"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Nginxçš„åŸºæœ¬é…ç½®</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-10-18T10:18:08+08:00">2017-10-18 </time></span><span></span> <span class="post-meta-divider">|</span> <span class="page-pv"><i class="fa fa-laptop"></i>&nbsp;&nbsp;Visit count <span class="busuanzi-value" id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><p>Nginxé…ç½®æ–‡ä»¶ä¸»è¦åˆ†æˆå››éƒ¨åˆ†ï¼šmainï¼ˆå…¨å±€è®¾ç½®ï¼‰ã€httpï¼ˆHTTPçš„é€šç”¨è®¾ç½®ï¼‰ã€serverï¼ˆè™šæ‹Ÿä¸»æœºè®¾ç½®ï¼‰ã€locationï¼ˆåŒ¹é…URLè·¯å¾„ï¼‰ã€‚è¿˜æœ‰ä¸€äº›å…¶ä»–çš„é…ç½®æ®µï¼Œå¦‚eventï¼Œupstreamç­‰ã€‚</p><p>ä¸€ä¸ªå®Œæ•´çš„Nginxé…ç½®å¦‚ä¸‹ï¼š</p><a id="more"></a><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">user</span>       www www;  <span class="comment">## Default: nobody</span></span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">5</span>;  <span class="comment">## Default: 1</span></span><br><span class="line"><span class="attribute">error_log</span>  logs/error.log;</span><br><span class="line"><span class="attribute">pid</span>        logs/nginx.pid;</span><br><span class="line"><span class="attribute">worker_rlimit_nofile</span> <span class="number">8192</span>;</span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">  <span class="attribute">worker_connections</span>  <span class="number">4096</span>;  <span class="comment">## Default: 1024</span></span><br><span class="line">  <span class="attribute">multi_accept</span> <span class="literal">on</span>;</span><br><span class="line">  <span class="attribute">use</span> <span class="literal">epoll</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">  <span class="attribute">include</span>    conf/mime.types;</span><br><span class="line">  <span class="attribute">include</span>    /etc/nginx/proxy.conf;</span><br><span class="line">  <span class="attribute">include</span>    /etc/nginx/fastcgi.conf;</span><br><span class="line">  <span class="attribute">index</span>    index.html index.htm index.php;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">default_type</span> application/octet-stream;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">log_format</span>   main <span class="string">'<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>]  <span class="variable">$status</span> '</span></span><br><span class="line">                    <span class="string">'"<span class="variable">$request</span>" <span class="variable">$body_bytes_sent</span> "<span class="variable">$http_referer</span>" '</span></span><br><span class="line">                    <span class="string">'"<span class="variable">$http_user_agent</span>" "<span class="variable">$http_x_forwarded_for</span>"'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">access_log</span>   logs/access.log  main;</span><br><span class="line">  <span class="attribute">sendfile</span>     <span class="literal">on</span>;</span><br><span class="line">  <span class="attribute">tcp_nopush</span>   <span class="literal">on</span>;</span><br><span class="line">  <span class="attribute">server_names_hash_bucket_size</span> <span class="number">128</span>; <span class="comment"># this seems to be required for some vhosts</span></span><br><span class="line"></span><br><span class="line">  <span class="section">server</span> &#123; <span class="comment"># php/fastcgi</span></span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  domain1.com www.domain1.com;</span><br><span class="line">    <span class="attribute">access_log</span>   logs/domain1.access.log  main;</span><br><span class="line">    <span class="attribute">root</span>         html;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">      <span class="attribute">fastcgi_pass</span>   <span class="number">127.0.0.1:1025</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="section">server</span> &#123; <span class="comment"># simple reverse-proxy</span></span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  domain2.com www.domain2.com;</span><br><span class="line">    <span class="attribute">access_log</span>   logs/domain2.access.log  main;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># serve static files</span></span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ ^/(images|javascript|js|css|flash|media|static)/</span>  &#123;</span><br><span class="line">      <span class="attribute">root</span>    /var/www/virtual/big.server.com/htdocs;</span><br><span class="line">      <span class="attribute">expires</span> <span class="number">30d</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># pass requests for dynamic content to rails/turbogears/zope, et al</span></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">      <span class="attribute">proxy_pass</span>      http://127.0.0.1:8080;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">upstream</span> big_server_com &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.3:8000</span> weight=<span class="number">5</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.3:8001</span> weight=<span class="number">5</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.0.1:8000</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.0.1:8001</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="section">server</span> &#123; <span class="comment"># simple load balancing</span></span><br><span class="line">    <span class="attribute">listen</span>          <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>     big.server.com;</span><br><span class="line">    <span class="attribute">access_log</span>      logs/big.server.access.log main;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">      <span class="attribute">proxy_pass</span>      http://big_server_com;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="NginxåŸºç¡€é…ç½®æŒ‡ä»¤"><a href="#NginxåŸºç¡€é…ç½®æŒ‡ä»¤" class="headerlink" title="NginxåŸºç¡€é…ç½®æŒ‡ä»¤"></a>NginxåŸºç¡€é…ç½®æŒ‡ä»¤</h2><h3 id="user"><a href="#user" class="headerlink" title="user"></a>user</h3><p>ç”¨äºæŒ‡å®šè¿è¡ŒNginxçš„ç”¨æˆ·å’Œç»„ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">user</span> user [group]</span><br></pre></td></tr></table></figure><p></p><p>åªæœ‰è¢«è®¾ç½®çš„ç”¨æˆ·æˆ–è€…ç”¨æˆ·ç»„æˆå‘˜æ‰æœ‰æƒé™å¯åŠ¨NginxæœåŠ¡ã€‚å¦‚æœå¸Œæœ›æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥å¯åŠ¨Nginxï¼Œåˆ™åªéœ€å°†å…¶æ³¨é‡Šæ‰æˆ–è€…æŒ‡å®šä¸ºï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">user</span> nobody nobody</span><br></pre></td></tr></table></figure><p></p><h3 id="worker-processes"><a href="#worker-processes" class="headerlink" title="worker_processes"></a>worker_processes</h3><p>æŒ‡å®šNginxçš„å·¥ä½œè¿›ç¨‹çš„ä¸ªæ•°ï¼Œå¯ä»¥è®¾ç½®ä¸ºä¸ CPU æ•°é‡ç›¸åŒï¼ŒåŸºæœ¬è¯­æ³•ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">worker_processes</span> number|auto</span><br></pre></td></tr></table></figure><p></p><p>è®¾ç½®ä¸ºautoæ—¶ï¼ŒNginxè¿›ç¨‹å°†è‡ªåŠ¨æ£€æµ‹ã€‚å½“worker_processesè®¾ç½®ä¸º1æ—¶ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sbin/nginx </span></span><br><span class="line"><span class="comment"># ps -ef|grep nginx</span></span><br><span class="line"><span class="attribute">root</span>      <span class="number">5882</span>  <span class="number">1326</span>  <span class="number">0</span> <span class="number">13</span>:<span class="number">07</span> ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> nginx: master process sbin/nginx</span><br><span class="line">nobody    <span class="number">5883</span>  <span class="number">5882</span>  <span class="number">0</span> <span class="number">13</span>:<span class="number">07</span> ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> nginx: worker process</span><br><span class="line">root      <span class="number">5885</span>  <span class="number">5430</span>  <span class="number">0</span> <span class="number">13</span>:<span class="number">07</span> pts/<span class="number">1</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> grep --color=auto nginx</span><br></pre></td></tr></table></figure><p></p><p>å°†worker_processesè®¾ç½®ä¸º3æ—¶ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ps -ef|grep nginx</span></span><br><span class="line"><span class="attribute">root</span>      <span class="number">5919</span>  <span class="number">1326</span>  <span class="number">0</span> <span class="number">13</span>:<span class="number">09</span> ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> nginx: master process sbin/nginx</span><br><span class="line">nobody    <span class="number">5920</span>  <span class="number">5919</span>  <span class="number">0</span> <span class="number">13</span>:<span class="number">09</span> ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> nginx: worker process</span><br><span class="line">nobody    <span class="number">5921</span>  <span class="number">5919</span>  <span class="number">0</span> <span class="number">13</span>:<span class="number">09</span> ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> nginx: worker process</span><br><span class="line">nobody    <span class="number">5922</span>  <span class="number">5919</span>  <span class="number">0</span> <span class="number">13</span>:<span class="number">09</span> ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> nginx: worker process</span><br><span class="line">root      <span class="number">5924</span>  <span class="number">5430</span>  <span class="number">0</span> <span class="number">13</span>:<span class="number">09</span> pts/<span class="number">1</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> grep --color=auto nginx</span><br></pre></td></tr></table></figure><p></p><p>worker_processesè¿›ç¨‹æ•°å˜æˆäº†3ä¸ªã€‚</p><h3 id="error-log"><a href="#error-log" class="headerlink" title="error_log"></a>error_log</h3><p>ç”¨äºé…ç½®é”™è¯¯æ—¥å¿—çš„å­˜æ”¾è·¯å¾„ã€‚httpï¼Œserverå’Œlocationå—ä¹Ÿå¯é…ç½®error_logï¼ŒåŒºåˆ«åœ¨äºçº§åˆ«ä¸ä¸€æ ·ã€‚åŸºæœ¬è¯­æ³•ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">error_log</span> files|stderr [ <span class="literal">debug</span> | <span class="literal">info</span> | <span class="literal">notice</span> | <span class="literal">warn</span> | <span class="literal">error</span> | <span class="literal">crit</span> | alert | emerg ]</span><br></pre></td></tr></table></figure><p></p><p>debugçº§åˆ«æœ€é«˜ï¼Œemergçº§åˆ«æœ€ä½ã€‚æ¯”å¦‚è®¾ç½®çº§åˆ«ä¸ºwarnåï¼Œwarnï¼Œerrorï¼Œcritï¼Œalertå’Œemergçº§åˆ«çš„æ—¥å¿—éƒ½ä¼šè¢«è®°å½•ã€‚Nginxé»˜è®¤æ—¥å¿—å­˜æ”¾è·¯å¾„ä¸ºï¼š<code>logs/error.log</code>ã€‚</p><h3 id="pid"><a href="#pid" class="headerlink" title="pid"></a>pid</h3><p>pidæŒ‡ä»¤ç”¨äºæŒ‡å®šå­˜æ”¾Nginxä¸»è¿›ç¨‹å·å­˜æ”¾æ–‡ä»¶çš„è·¯å¾„ã€‚é»˜è®¤çš„è·¯å¾„ä¸ºï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ./sbin/nginx </span></span><br><span class="line"><span class="comment"># cat logs/nginx.pid </span></span><br><span class="line">101106</span><br></pre></td></tr></table></figure><p></p><h3 id="worker-rlimit-nofile"><a href="#worker-rlimit-nofile" class="headerlink" title="worker_rlimit_nofile"></a>worker_rlimit_nofile</h3><p>è®¾ç½®æ¯ä¸ªè¿›ç¨‹çš„æœ€å¤§æ–‡ä»¶æ‰“å¼€æ•°ã€‚å¦‚æœä¸è®¾çš„è¯ä¸Šé™å°±æ˜¯ç³»ç»Ÿçš„ulimit â€“nçš„æ•°å­—ï¼ˆ1024ï¼‰ã€‚</p><h3 id="worker-connections"><a href="#worker-connections" class="headerlink" title="worker_connections"></a>worker_connections</h3><p>è®¾å®šä¸€ä¸ªworkerè¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°ã€‚é»˜è®¤ä¸º512ï¼ŒæŒ‰è‡ªå·±ç³»ç»Ÿçš„ç¡¬ä»¶é…ç½®è°ƒæ•´ï¼Œä¸èƒ½è¶…è¿‡worker_rlimit_nofileã€‚</p><h3 id="include"><a href="#include" class="headerlink" title="include"></a>include</h3><p>includeæŒ‡ä»¤ç”¨äºå¼•å…¥ç¬¬ä¸‰æ–¹é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚å¸¸è§çš„MIMEç±»å‹ç­‰ã€‚</p><h3 id="accept-mutex"><a href="#accept-mutex" class="headerlink" title="accept_mutex"></a>accept_mutex</h3><p>è¯¥æ¡æŒ‡ä»¤ç›®çš„æ˜¯ä¸ºäº†è§£å†³â€œæƒŠç¾¤â€çš„é—®é¢˜ã€‚â€œæƒŠç¾¤â€å¤§è‡´æ„æ€æ˜¯ï¼šå½“æŸä¸ªæ—¶åˆ»åªæœ‰ä¸€ä¸ªç½‘ç»œè¿æ¥æ—¶ï¼Œå¤šä¸ªè¿›ç¨‹ä¼šè¢«åŒæ—¶å”¤é†’ï¼Œä½†æœ€ç»ˆå®é™…ä¸Šåªæœ‰ä¸€ä¸ªè¿›ç¨‹å¯ä»¥è·å¾—è¿æ¥ï¼Œç”±äºå”¤é†’äº†åˆ«çš„ä¸å¿…è¦çš„è¿›ç¨‹ï¼Œé€ æˆäº†æ€§èƒ½çš„æµªè´¹ã€‚</p><p>accept_mutexè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">accept_mutex</span> <span class="literal">on</span> | <span class="literal">off</span></span><br></pre></td></tr></table></figure><p></p><p>é»˜è®¤ä¸ºå¼€å¯ï¼ˆonï¼‰çŠ¶æ€ï¼Œåªèƒ½åœ¨eventså—ä¸­è¿›è¡Œè®¾ç½®ã€‚</p><h3 id="multi-accept"><a href="#multi-accept" class="headerlink" title="multi_accept"></a>multi_accept</h3><p>ç”¨äºè®¾ç½®æ˜¯å¦å…è®¸worker_processåŒæ—¶æ¥å—å¤šä¸ªç½‘ç»œè¿æ¥ã€‚è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">multi_accept</span> <span class="literal">on</span> | <span class="literal">off</span></span><br></pre></td></tr></table></figure><p></p><p>å…¶é»˜è®¤ä¸ºå…³é—­ï¼ˆoffï¼‰çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªworker_processä¸€æ¬¡åªèƒ½æ¥æ”¶ä¸€ä¸ªæ–°åˆ°è¾¾çš„ç½‘ç»œè¿æ¥ã€‚</p><p>è¯¥æŒ‡ä»¤åªèƒ½åœ¨eventsæ¨¡å—ä¸­è®¾ç½®ã€‚</p><h3 id="use"><a href="#use" class="headerlink" title="use"></a>use</h3><p>useæŒ‡ä»¤ç”¨äºé€‰æ‹©äº‹ä»¶çš„é©±åŠ¨æ¨¡å‹ã€‚è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">use</span> method</span><br></pre></td></tr></table></figure><p></p><p>Nginxæä¾›äº†å¤šç§äº‹ä»¶é©±åŠ¨æ¨¡å‹æ¥å¤„ç†ç½‘ç»œæ¶ˆæ¯ï¼Œmethodå¯é€‰çš„å†…å®¹æœ‰ï¼šselectï¼Œpollï¼Œkqueueï¼Œepollï¼Œrtsigï¼Œ/dev/pollå’Œeventportã€‚</p><p>è¯¥æŒ‡ä»¤åªèƒ½åœ¨eventsæ¨¡å—ä¸­è®¾ç½®ã€‚</p><h3 id="worker-connentions"><a href="#worker-connentions" class="headerlink" title="worker_connentions"></a>worker_connentions</h3><p>ç”¨äºè®¾ç½®æ¯ä¸ªworker_processæœ€å¤§çš„è¿æ¥æ•°ã€‚è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">worker_process</span> number</span><br></pre></td></tr></table></figure><p></p><p>è¯¥æŒ‡ä»¤åªèƒ½åœ¨eventsæ¨¡å—ä¸­è®¾ç½®ã€‚</p><h3 id="æŒ‡å®šMIME"><a href="#æŒ‡å®šMIME" class="headerlink" title="æŒ‡å®šMIME"></a>æŒ‡å®šMIME</h3><p>åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä¸¤æ¡é…ç½®ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">include</span>    conf/mime.types;</span><br><span class="line"><span class="attribute">default_type</span> application/octet-stream;</span><br></pre></td></tr></table></figure><p></p><p>includeæŒ‡ä»¤å¼•å…¥äº†mime.typesæ–‡ä»¶ï¼Œå…¶ä¸­mime.typeså†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">types</span> &#123;</span><br><span class="line">    text/html                             html htm shtml;</span><br><span class="line">    text/css                              css;</span><br><span class="line">    text/xml                              xml;</span><br><span class="line">    image/gif                             gif;</span><br><span class="line">    image/jpeg                            jpeg jpg;</span><br><span class="line">    application/javascript                js;</span><br><span class="line">    application/atom+xml                  atom;</span><br><span class="line">    application/rss+xml                   rss;</span><br><span class="line"></span><br><span class="line">    text/mathml                           mml;</span><br><span class="line">    text/plain                            txt;</span><br><span class="line">    text/vnd.sun.j2me.app-descriptor      jad;</span><br><span class="line">    text/vnd.wap.wml                      wml;</span><br><span class="line">    text/x-component                      htc;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    video/3gpp                            3gpp 3gp;</span><br><span class="line">    video/mp2t                            ts;</span><br><span class="line">    video/mp4                             mp4;</span><br><span class="line">    video/mpeg                            mpeg mpg;</span><br><span class="line">    video/quicktime                       mov;</span><br><span class="line">    video/webm                            webm;</span><br><span class="line">    video/x-flv                           flv;</span><br><span class="line">    video/x-m4v                           m4v;</span><br><span class="line">    video/x-mng                           mng;</span><br><span class="line">    video/x-ms-asf                        asx asf;</span><br><span class="line">    video/x-ms-wmv                        wmv;</span><br><span class="line">    video/x-msvideo                       avi;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><code>default_type application/octet-stream</code>æŒ‡å®šäº†é»˜è®¤ç±»å‹ä¸ºäºŒè¿›åˆ¶æµã€‚å¦‚æœä¸æŒ‡å®šçš„è¯ï¼Œé»˜è®¤å€¼ä¸ºtext/plainã€‚</p><p>è¯¥æŒ‡ä»¤å¯ä»¥åœ¨httpï¼Œserveræˆ–locationæ¨¡å—ä¸­è®¾ç½®ã€‚</p><h3 id="è‡ªå®šä¹‰æœåŠ¡æ—¥å¿—"><a href="#è‡ªå®šä¹‰æœåŠ¡æ—¥å¿—" class="headerlink" title="è‡ªå®šä¹‰æœåŠ¡æ—¥å¿—"></a>è‡ªå®šä¹‰æœåŠ¡æ—¥å¿—</h3><p>error_logç”¨äºè®°å½•Nginxè¿è¡Œæ—¶çš„å¸¸è§„æ—¥å¿—ï¼Œè€Œaccess_logï¼ˆæœåŠ¡æ—¥å¿—ï¼‰æ˜¯æŒ‡NginxæœåŠ¡å™¨åœ¨å“åº”å„ç§å‰ç«¯è¯·æ±‚çš„æ—¥å¿—ã€‚åŒ…å«ä¸¤ä¸ªæŒ‡ä»¤ï¼šaccess_logå’Œlog_formatã€‚</p><p>access_logçš„è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">access_log</span> ptah[format[buffer=size]]</span><br></pre></td></tr></table></figure><p></p><p><code>path</code>ç”¨äºæŒ‡å®šè¯¥æ—¥å¿—çš„å­˜æ”¾è·¯å¾„ï¼Œ<code>format</code>ä¸ºå¯é€‰é¡¹ï¼Œä»£æŒ‡è‡ªå®šä¹‰æœåŠ¡æ—¥å¿—çš„æ ¼å¼å­—ç¬¦ä¸²ã€‚<code>size</code>ä¸ºå¯é€‰é¡¹ï¼Œç”¨äºé…ç½®ä¸´æ—¶å­˜æ”¾æ—¥å¿—çš„å†…å­˜ç¼“å­˜åŒºå¤§å°ã€‚</p><p>log_formatçš„è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">log_format</span> name string ...</span><br></pre></td></tr></table></figure><p></p><p><code>name</code>ç”¨äºä¸ºè¯¥æ ¼å¼å®šä¹‰ä¸€ä¸ªå˜é‡åï¼Œä¾›access_logæŒ‡ä»¤ä½¿ç”¨ã€‚<code>string</code>ä¸ºæ ¼å¼å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ï¼š<code>$remote_addr - $remote_user [$time_local] $status</code>å…¶ä¸­<code>$remote_addr</code>ç­‰ä¸ºNginxé¢„è®¾çš„ä¸€äº›å˜é‡ï¼Œå¸¸ç”¨çš„å˜é‡æœ‰ï¼š</p><table><tr><td><strong>å‚æ•°</strong></td><td><strong>è¯´æ˜</strong></td><td><strong>ç¤ºä¾‹</strong></td></tr><tr><td width="192" height="29">$remote_addr</td><td width="246">å®¢æˆ·ç«¯åœ°å€</td><td width="289">211.28.65.253</td></tr><tr><td width="192" height="29">$remote_user</td><td width="246">å®¢æˆ·ç«¯ç”¨æˆ·åç§°</td><td width="289">â€“</td></tr><tr><td width="192" height="29"><span lang="EN-US">$time_local</span></td><td width="246">è®¿é—®æ—¶é—´å’Œæ—¶åŒº</td><td width="289">18/Jul/2012:17:00:01 +0800</td></tr><tr><td width="192" height="29">$request</td><td width="246">è¯·æ±‚çš„URIå’ŒHTTPåè®®</td><td width="289">â€œGET /article-10000.html HTTP/1.1â€</td></tr><tr><td width="192" height="50">$http_host</td><td width="246">è¯·æ±‚åœ°å€ï¼Œå³æµè§ˆå™¨ä¸­ä½ è¾“å…¥çš„åœ°å€ï¼ˆIPæˆ–åŸŸåï¼‰</td><td width="289"><a href="http://www.it300.com" target="_blank" rel="noopener">www.it300.com</a><br>192.168.100.100</td></tr><tr><td width="192" height="29">$status</td><td width="246">HTTPè¯·æ±‚çŠ¶æ€</td><td width="289">200</td></tr><tr><td width="192" height="29">$upstream_status</td><td width="246">upstreamçŠ¶æ€</td><td width="289">200</td></tr><tr><td width="192" height="29">$body_bytes_sent</td><td width="246">å‘é€ç»™å®¢æˆ·ç«¯æ–‡ä»¶å†…å®¹å¤§å°</td><td width="289">1547</td></tr><tr><td width="192" height="29"><span lang="EN-US">$http_referer</span></td><td width="246">urlè·³è½¬æ¥æº</td><td width="289"><a href="https://www.baidu.com/" target="_blank" rel="noopener">https://www.baidu.com/</a></td></tr><tr><td width="192" height="62">$http_user_agent</td><td width="246">ç”¨æˆ·ç»ˆç«¯æµè§ˆå™¨ç­‰ä¿¡æ¯</td><td width="289">â€œMozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; SV1; GTB7.0; .NET4.0C;</td></tr><tr><td width="192" height="29"><span lang="EN-US">$ssl_protocol</span></td><td width="246">SSLåè®®ç‰ˆæœ¬</td><td width="289">TLSv1</td></tr><tr><td width="192" height="29">$ssl_cipher</td><td width="246">äº¤æ¢æ•°æ®ä¸­çš„ç®—æ³•</td><td width="289">RC4-SHA</td></tr><tr><td width="192" height="48">$upstream_addr</td><td width="246">åå°upstreamçš„åœ°å€ï¼Œå³çœŸæ­£æä¾›æœåŠ¡çš„ä¸»æœºåœ°å€</td><td width="289">10.10.10.100:80</td></tr><tr><td width="192" height="29">$request_time</td><td width="246">æ•´ä¸ªè¯·æ±‚çš„æ€»æ—¶é—´</td><td width="289">0.205</td></tr><tr><td width="192" height="29">$upstream_response_time</td><td width="246">è¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œupstreamå“åº”æ—¶é—´</td><td width="289">0.002</td></tr></table><p>è¯¥æŒ‡ä»¤åªèƒ½åœ¨httpæ¨¡å—ä¸­è®¾ç½®ã€‚</p><h3 id="sendfile-amp-sendfile-max-chunk"><a href="#sendfile-amp-sendfile-max-chunk" class="headerlink" title="sendfile &amp; sendfile_max_chunk"></a>sendfile &amp; sendfile_max_chunk</h3><p>sendfileç”¨äºå¼€å¯æˆ–å…³é—­ä½¿ç”¨sendfile()ä¼ è¾“æ–‡ä»¶ã€‚è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sendfile</span> <span class="literal">on</span> | <span class="literal">off</span></span><br></pre></td></tr></table></figure><p></p><p>å¯ä»¥åœ¨httpï¼Œserveræˆ–locationä¸­è¿›è¡Œé…ç½®ã€‚</p><p>sendfile_max_chunkç”¨äºè®¾ç½®Nginxè¿›ç¨‹ä¸­çš„æ¯ä¸ªworker_processæ¯æ¬¡è°ƒç”¨sendfile()ä¼ è¾“çš„æ•°æ®é‡çš„æœ€å¤§å€¼ã€‚é»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºæ²¡æœ‰é™åˆ¶ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sendfile_max_chunk</span> <span class="number">128k</span></span><br></pre></td></tr></table></figure><p></p><p>è¯¥æŒ‡ä»¤å¯ä»¥åœ¨httpï¼Œserveræˆ–locationå—ä¸­é…ç½®ã€‚</p><h3 id="keepalive-timeout"><a href="#keepalive-timeout" class="headerlink" title="keepalive_timeout"></a>keepalive_timeout</h3><p>ç”¨äºè®¾ç½®NginxæœåŠ¡å™¨ä¸ç”¨æˆ·å»ºç«‹ä¼šè¯è¿æ¥ä¿æŒçš„æ—¶é—´ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">keepalive_timeout</span> timeout[header_timeout]</span><br></pre></td></tr></table></figure><p></p><p><code>timeout</code>ç”¨äºè®¾ç½®æœåŠ¡å™¨ç«¯ä¿æŒè¿æ¥çš„æ—¶é—´ï¼›<code>header_timeout</code>ä¸ºå¯é€‰é¡¹ï¼Œç”¨äºé…ç½®åº”ç­”æŠ¥æ–‡å¤´éƒ¨çš„Keep-AliveåŸŸçš„å€¼ã€‚</p><p>è¯¥æŒ‡ä»¤å¯ä»¥åœ¨httpï¼Œserverå’Œlocationå—ä¸­é…ç½®ã€‚</p><h3 id="keepalive-requests"><a href="#keepalive-requests" class="headerlink" title="keepalive_requests"></a>keepalive_requests</h3><p>ç”¨äºé™åˆ¶ç”¨æˆ·é€šè¿‡æŸä¸€è¿æ¥å‘æœåŠ¡å™¨å‘é€è¯·æ±‚çš„æ¬¡æ•°ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">keepalive_requests</span> number</span><br></pre></td></tr></table></figure><p></p><p>é»˜è®¤å€¼ä¸º100ï¼Œå¯ä»¥åœ¨httpï¼Œserverå’Œlocationå—ä¸­é…ç½®ã€‚</p><h3 id="listen"><a href="#listen" class="headerlink" title="listen"></a>listen</h3><p>è¯¥æŒ‡ä»¤ç”¨äºé…ç½®ç›‘å¬ã€‚é…ç½®æ–¹æ³•ä¸»è¦æœ‰ä¸‰ç§ï¼š</p><p>1ã€é…ç½®ç›‘å¬çš„IPåœ°å€ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">listen</span> address[:port] [default_server] [setfib=number] [backlog=number] [rcvbuf=size] [sndbuf=size] [deferred] [accept_filter=filter] [bind] [ssl]</span><br></pre></td></tr></table></figure><p></p><p>2ã€é…ç½®ç›‘å¬ç«¯å£</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">listen</span> port [default_server] [setfib=number] [backlog=number] [rcvbuf=size] [sndbuf=size] [deferred] [accept_filter=filter] [bind] [ipv6only=<span class="literal">on</span>|<span class="literal">off</span>] [ssl]</span><br></pre></td></tr></table></figure><p></p><p>3ã€é…ç½®UNIX Domain Socket</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">listen</span> unix:path [default_server] [setfib=number] [backlog=number] [rcvbuf=size] [sndbuf=size] [deferred] [accept_filter=filter] [bind] [ssl]</span><br></pre></td></tr></table></figure><p></p><ul><li><p><code>address</code>ï¼ŒIPåœ°å€ï¼Œå¦‚æœæ˜¯IPv6çš„åœ°å€ï¼Œéœ€ä½¿ç”¨[]ï¼Œæ¯”å¦‚[fe80 ::1]ã€‚</p></li><li><p><code>port</code>ï¼Œç«¯å£å·ã€‚</p></li><li><p><code>path</code>ï¼Œsocketæ–‡ä»¶è·¯å¾„ï¼Œå¦‚/var/run/nginx.sockç­‰ã€‚</p></li><li><p><code>default_server</code>ï¼Œæ ‡è¯†ç¬¦ï¼Œè¡¨ç¤ºè®¾ç½®ä¸ºé»˜è®¤ä¸»æœºã€‚</p></li><li><p><code>rcvbuf=size</code>ï¼Œè®¾ç½®ç›‘å¬socketæ¥æ”¶ç¼“å­˜åŒºå¤§å°ã€‚</p></li><li><p><code>sndbuf=size</code>ï¼Œè®¾ç½®ç›‘å¬socketå‘é€ç¼“å­˜åŒºå¤§å°ã€‚</p></li><li><p><code>deferred</code>ï¼Œæ ‡è¯†ç¬¦ï¼Œå°†accept()è®¾ç½®ä¸ºDeferredæ¨¡å¼ã€‚</p></li><li><p><code>accept_filter=filter</code>ï¼Œè®¾ç½®ç›‘å¬ç«¯å£å¯¹è¯·æ±‚çš„è¿‡æ»¤ ï¼Œè¢«è¿‡æ»¤çš„å†…å®¹ä¸èƒ½è¢«æ¥æ”¶å’Œå¤„ç†ã€‚</p></li><li><p><code>ssl</code>ï¼Œæ ‡è¯†ç¬¦ï¼Œè®¾ç½®ä¼šè¯è¿æ¥ä½¿ç”¨SSLæ¨¡å¼è¿›è¡Œã€‚</p></li></ul><p>ä¸€äº›ä¾‹å­ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">listen</span> *:<span class="number">80</span> | *:<span class="number">8080</span>;  <span class="comment">#ç›‘å¬æ‰€æœ‰80ç«¯å£å’Œ8080ç«¯å£</span></span><br><span class="line"><span class="attribute">listen</span> <span class="number">192.168.1.10:8080</span>; ã€€<span class="comment">#ç›‘å¬å…·ä½“IPå’Œå…·ä½“ç«¯å£ä¸Šçš„è¿æ¥</span></span><br><span class="line"><span class="attribute">listen</span> <span class="number">8000</span>;  <span class="comment">#ç›‘å¬æ‰€æœ‰IPåœ°å€çš„8000ç«¯å£ï¼Œç­‰åŒäº listen *:8000</span></span><br><span class="line"><span class="attribute">listen</span> <span class="number">192.168.1.10</span> default_server;  <span class="comment">#è®¾ç½®192.168.1.10çš„è¿æ¥è¯·æ±‚é»˜è®¤ç”±æ­¤è™šæ‹Ÿä¸»æœºå¤„ç†</span></span><br></pre></td></tr></table></figure><p></p><h3 id="server-name"><a href="#server-name" class="headerlink" title="server_name"></a>server_name</h3><p>Nginxé…ç½®æ–‡ä»¶ä¸­çš„æ¯ä¸ªserverå—å¯¹äºä¸€ä¸ªè™šæ‹Ÿä¸»æœºé…ç½®ï¼Œserver_nameç”¨äºæŒ‡å®šè™šæ‹Ÿä¸»æœºçš„åç§°ï¼Œç”¨æˆ·å¯é€šè¿‡è¿™ä¸ªåç§°æ¥å‘æ­¤è™šæ‹Ÿä¸»æœºå‘é€è¯·æ±‚ã€‚server_nameçš„é…ç½®åˆ†ä¸ºåç§°å’ŒIPä¸¤ç§æ–¹å¼ã€‚</p><p><strong>åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœºé…ç½®</strong></p><p>åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœºé…ç½®æ—¶ï¼Œserver_nameçš„è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">server_name</span> name ...</span><br></pre></td></tr></table></figure><p></p><p>nameå¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªåç§°å¹¶åˆ—ï¼Œç”¨ç©ºæ ¼éš”å¼€ã€‚æ¯ä¸ªåç§°å¯¹åº”ä¸€ä¸ªåŸŸåï¼Œç”±ä¸¤æ®µæˆ–è€…ä¸‰æ®µç»„æˆï¼Œä¹‹é—´ç”±<code>.</code>éš”å¼€ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">server_name</span> www.mrbird.cc mrbird.cc;</span><br></pre></td></tr></table></figure><p></p><p>1ã€åœ¨nameä¸­å¯ä»¥ä½¿ç”¨é€šé…ç¬¦<code>*</code>ï¼Œé€šé…ç¬¦å¯ç”¨åœ¨ä¸‰æ®µå¼åŸŸåçš„å¤´æˆ–å°¾ï¼Œæˆ–ä¸¤æ®µå¼åŸŸåçš„å°¾éƒ¨ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">server_name</span> <span class="regexp">*.mrbird.cc</span> <span class="regexp">mrbird.*</span>;</span><br></pre></td></tr></table></figure><p></p><p>2ã€åœ¨nameä¸­è¿˜å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ã€‚ä½¿ç”¨<code>~</code>ä½œä¸ºæ­£åˆ™è¡¨è¾¾å¼å¼€å§‹çš„æ ‡è®°ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">server_name</span> ~^www\d+\.mrbird\.cc$;</span><br></pre></td></tr></table></figure><p></p><p>æ­¤æ—¶æ¯”å¦‚é€šè¿‡<code>www1.mrbird.cc</code>å¯ä»¥è®¿é—®NginxæœåŠ¡ï¼Œè€Œ<code>www.mrbird.cc</code>ä¸å¯ä»¥ã€‚</p><p>nameä¸­çš„æ­£åˆ™è¡¨è¾¾å¼æ”¯æŒå­—ç¬¦ä¸²æ•è·åŠŸèƒ½ï¼Œå­—ç¬¦ä¸²æ•è·é€šè¿‡<code>( )</code>æ¥æ‹¾å–åé¢ä¸ç´§è·Ÿå…¶ä»–çš„æ­£åˆ™è¡¨è¾¾å¼çš„å­—ç¬¦ã€‚ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªä¸åµŒå¥—çš„å°æ‹¬å·ï¼Œè¿™äº›å†…å®¹ä¼šä»å·¦åˆ°å³ä¾æ¬¡å­˜æ”¾åœ¨å˜é‡<code>$1</code>ã€<code>$2</code>ã€<code>$3</code>â€¦â€¦ä¸­ã€‚ä¸‹æ–‡ä½¿ç”¨æ—¶å°±å¯ç›´æ¥ä½¿ç”¨è¿™äº›å˜é‡ï¼Œä½œç”¨åŸŸä¸ºå½“å‰çš„serverå—ã€‚</p><p>æ¯”å¦‚æœ‰å¦‚ä¸‹çš„server_nameé…ç½®ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">server_name</span> ~^www\.(.+)\.cc$;</span><br></pre></td></tr></table></figure><p></p><p>å½“é€šè¿‡<code>www.mrbird.cc</code>è®¿é—®NginxæœåŠ¡å™¨æ—¶ï¼Œå°†ä¼šè¢«ä¸Šé¢çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æˆåŠŸï¼Œmrbirdå°†ä¼šè¢«æ•è·ï¼Œå¹¶ä¸”èµ‹å€¼ç»™$1ã€‚</p><p>ç”±äºæœ‰ä¸¤ç§åŒ¹é…çš„æ–¹å¼ï¼Œæ‰€ä»¥æœ‰å¯èƒ½å‡ºç°ä¸¤ç§æƒ…å†µéƒ½åŒ¹é…çš„æ—¶å€™ï¼Œè¿™æ—¶å€™NginxæŒ‰ç…§ä»¥ä¸‹çš„ä¼˜å…ˆçº§è¿›è¡Œé€‰æ‹©ï¼š</p><ol><li><p>å‡†ç¡®åŒ¹é…server_nameã€‚</p></li><li><p>é€šé…ç¬¦åœ¨å¼€å§‹æ—¶åŒ¹é…server_nameæˆåŠŸã€‚</p></li><li><p>é€šé…ç¬¦åœ¨ç»“æŸæ—¶åŒ¹é…server_nameæˆåŠŸã€‚</p></li><li><p>æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…server_nameæˆåŠŸã€‚</p></li></ol><p>æ­¤å¤–ï¼Œå¦‚æœserver_nameè¢«å¤„äºåŒä¸€ä¼˜å…ˆçº§çš„åŒ¹é…æ–¹å¼å¤šæ¬¡åŒ¹é…æˆåŠŸï¼Œåˆ™ä»¥é¦–å…ˆåŒ¹é…æˆåŠŸçš„ä¸ºä¸»ã€‚</p><p><strong>åŸºäºIPçš„è™šæ‹Ÿä¸»æœºé…ç½®</strong></p><p>Linuxæ“ä½œç³»ç»Ÿæ”¯æŒIPåˆ«åçš„æ·»åŠ ï¼Œé…ç½®åŸºäºIPçš„è™šæ‹Ÿä¸»æœºï¼Œå³ä¸ºNginxæœåŠ¡å™¨æä¾›çš„æ¯å°è™šæ‹Ÿä¸»æœºé…ç½®ä¸€ä¸ªä¸åŒçš„IPã€‚</p><p>æŸ¥çœ‹å½“å‰ç½‘ç»œé…ç½®ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ifconfig</span></span><br><span class="line"><span class="attribute">ens33</span>     Link encap:Ethernet  HWaddr <span class="number">00</span>:0c:<span class="number">29</span>:<span class="number">25</span>:f3:bb  </span><br><span class="line">          inet addr:<span class="number">192.168.112.128</span>  Bcast:<span class="number">192.168.112.255</span>  Mask:<span class="number">255.255.255.0</span></span><br><span class="line">          inet6 addr: fe80::4fe4:f0e0:9e9b:7ec/<span class="number">64</span> Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:<span class="number">1500</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">360100</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">89081</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">1000</span> </span><br><span class="line">          RX bytes:<span class="number">504446360</span> (<span class="number">504</span>.<span class="number">4</span> MB)  TX bytes:<span class="number">7347923</span> (<span class="number">7</span>.<span class="number">3</span> MB)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback  </span><br><span class="line">          inet addr:<span class="number">127.0.0.1</span>  Mask:<span class="number">255.0.0.0</span></span><br><span class="line">          inet6 addr: ::<span class="number">1</span>/<span class="number">128</span> Scope:Host</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:<span class="number">65536</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">35127</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">35127</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">1</span> </span><br><span class="line">          RX bytes:<span class="number">2931450</span> (<span class="number">2</span>.<span class="number">9</span> MB)  TX by</span><br></pre></td></tr></table></figure><p></p><p>ens33ä¸ºæ­£åœ¨ä½¿ç”¨çš„ç½‘å¡ï¼ŒIPä¸º<code>192.168.112.128</code>ï¼Œç»™å…¶æ·»åŠ ä¸¤ä¸ªIPåˆ«å<code>192.168.112.130</code>å’Œ<code>192.168.112.131</code>ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ifconfig ens33:0 192.168.112.130 Mask 255.255.255.0 up </span></span><br><span class="line"><span class="comment"># ifconfig ens33:1 192.168.112.131 Mask 255.255.255.0 up </span></span><br><span class="line"><span class="comment"># ifconfig</span></span><br><span class="line"><span class="attribute">ens33</span>     Link encap:Ethernet  HWaddr <span class="number">00</span>:0c:<span class="number">29</span>:<span class="number">25</span>:f3:bb  </span><br><span class="line">          inet addr:<span class="number">192.168.112.128</span>  Bcast:<span class="number">192.168.112.255</span>  Mask:<span class="number">255.255.255.0</span></span><br><span class="line">          inet6 addr: fe80::4fe4:f0e0:9e9b:7ec/<span class="number">64</span> Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:<span class="number">1500</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">360100</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">89081</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">1000</span> </span><br><span class="line">          RX bytes:<span class="number">504446360</span> (<span class="number">504</span>.<span class="number">4</span> MB)  TX bytes:<span class="number">7347923</span> (<span class="number">7</span>.<span class="number">3</span> MB)</span><br><span class="line"></span><br><span class="line">ens33:<span class="number">0</span>   Link encap:Ethernet  HWaddr <span class="number">00</span>:0c:<span class="number">29</span>:<span class="number">25</span>:f3:bb  </span><br><span class="line">          inet addr:<span class="number">192.168.112.130</span>  Bcast:<span class="number">192.168.112.255</span>  Mask:<span class="number">255.255.255.0</span></span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:<span class="number">1500</span>  Metric:<span class="number">1</span></span><br><span class="line"></span><br><span class="line">ens33:<span class="number">1</span>   Link encap:Ethernet  HWaddr <span class="number">00</span>:0c:<span class="number">29</span>:<span class="number">25</span>:f3:bb  </span><br><span class="line">          inet addr:<span class="number">192.168.112.131</span>  Bcast:<span class="number">192.168.112.255</span>  Mask:<span class="number">255.255.255.0</span></span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:<span class="number">1500</span>  Metric:<span class="number">1</span></span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback  </span><br><span class="line">          inet addr:<span class="number">127.0.0.1</span>  Mask:<span class="number">255.0.0.0</span></span><br><span class="line">          inet6 addr: ::<span class="number">1</span>/<span class="number">128</span> Scope:Host</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:<span class="number">65536</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">221</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">221</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">1</span> </span><br><span class="line">          RX bytes:<span class="number">16787</span> (<span class="number">16</span>.<span class="number">7</span> KB)  TX bytes:<span class="number">16787</span> (<span class="number">16</span>.<span class="number">7</span> KB)</span><br></pre></td></tr></table></figure><p></p><p>å…³äºç»™ç½‘å¡æ·»åŠ å¤šä¸ªIPåˆ«åå¯ä»¥å‚è€ƒ<a href="http://www.cnblogs.com/biaopei/p/7730517.html" target="_blank" rel="noopener">http://www.cnblogs.com/biaopei/p/7730517.html</a></p><p>è¿™æ—¶å€™å°±å¯ä»¥åœ¨Nginxé…ç½®æ–‡ä»¶ä¸­é…ç½®ä¸¤å°åŸºäºIPé…ç½®çš„è™šæ‹Ÿä¸»æœºäº†ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  <span class="section">http</span> &#123;</span><br><span class="line">  	...</span><br><span class="line">  	<span class="section">server</span> &#123;</span><br><span class="line">  		listen: 80;</span><br><span class="line">  		server_name: 192.168.112.130;</span><br><span class="line">  		...</span><br><span class="line">  	&#125;</span><br><span class="line">  	<span class="section">server</span> &#123;</span><br><span class="line">  		listen: 80;</span><br><span class="line">  		server_name: 192.168.112.131;</span><br><span class="line">  	&#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="locationå—"><a href="#locationå—" class="headerlink" title="locationå—"></a>locationå—</h3><p>locationè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">location [ = | ~ | ~* | ^~ ] uri &#123; ... &#125;</span><br></pre></td></tr></table></figure><p></p><p>uriæ˜¯å¾…åŒ¹é…çš„è¯·æ±‚å­—ç¬¦ä¸²ï¼Œå¯ä»¥æ˜¯æ ‡å‡†uriï¼ˆä¸å«æ­£åˆ™è¡¨è¾¾å¼ï¼‰å’Œæ­£åˆ™uriã€‚</p><ul><li><p><code>=</code>ç”¨äºæ ‡å‡†uriå‰ï¼Œè¦æ±‚è¯·æ±‚å­—ç¬¦ä¸²ä¸uriä¸¥æ ¼åŒ¹é…ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™åœæ­¢æœç´¢å¹¶ç«‹å³å¤„ç†æ­¤è¯·æ±‚ã€‚</p></li><li><p><code>~</code>ç”¨äºè¡¨ç¤ºuriå«æ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒºåˆ†å¤§å°å†™ã€‚</p></li><li><p><code>~*</code>ç”¨äºè¡¨ç¤ºuriåŒ…å«æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸åŒºåˆ†å¤§å°å†™ã€‚</p></li><li><p><code>^~</code>ç”¨äºæ ‡å‡†uriå‰ï¼Œè¦æ±‚NginxæœåŠ¡å™¨æ‰¾åˆ°å’Œè¯·æ±‚å­—ç¬¦ä¸²åŒ¹é…åº¦æœ€é«˜çš„æ ‡å‡†uriå¯¹åº”çš„locationåï¼Œç«‹å³ç”¨æ­¤locationå¤„ç†è¯·æ±‚ï¼Œè€Œä¸å†ä½¿ç”¨locationå—ä¸­çš„æ­£åˆ™uriå’Œè¯·æ±‚å­—ç¬¦ä¸²åšåŒ¹é…ã€‚</p></li></ul><p>ä¸€ä¸ªç¤ºä¾‹ï¼š</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">location</span>  <span class="title">= / &#123;</span></span><br><span class="line"><span class="title">  # ç²¾ç¡®åŒ¹é… / ï¼Œä¸»æœºååé¢ä¸èƒ½å¸¦ä»»ä½•å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="title">  [ configuration</span> A ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">location</span>  <span class="title">/ &#123;</span></span><br><span class="line"><span class="title">  # å› ä¸ºæ‰€æœ‰çš„åœ°å€éƒ½ä»¥ / å¼€å¤´ï¼Œæ‰€ä»¥è¿™æ¡è§„åˆ™å°†åŒ¹é…åˆ°æ‰€æœ‰è¯·æ±‚</span></span><br><span class="line"><span class="title">  # ä½†æ˜¯æ­£åˆ™å’Œæœ€é•¿å­—ç¬¦ä¸²ä¼šä¼˜å…ˆåŒ¹é…</span></span><br><span class="line"><span class="title">  [ configuration</span> B ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">location</span> <span class="title">/documents</span>/ &#123;</span><br><span class="line">  <span class="comment"># åŒ¹é…ä»»ä½•ä»¥ /documents/ å¼€å¤´çš„åœ°å€ï¼ŒåŒ¹é…ç¬¦åˆä»¥åï¼Œè¿˜è¦ç»§ç»­å¾€ä¸‹æœç´¢</span></span><br><span class="line">  <span class="comment"># åªæœ‰åé¢çš„æ­£åˆ™è¡¨è¾¾å¼æ²¡æœ‰åŒ¹é…åˆ°æ—¶ï¼Œè¿™ä¸€æ¡æ‰ä¼šé‡‡ç”¨è¿™ä¸€æ¡</span></span><br><span class="line">  [ configuration C ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">location</span> <span class="title">~ /documents</span>/Abc &#123;</span><br><span class="line">  <span class="comment"># åŒ¹é…ä»»ä½•ä»¥ /documents/Abc å¼€å¤´çš„åœ°å€ï¼ŒåŒ¹é…ç¬¦åˆä»¥åï¼Œè¿˜è¦ç»§ç»­å¾€ä¸‹æœç´¢</span></span><br><span class="line">  <span class="comment"># åªæœ‰åé¢çš„æ­£åˆ™è¡¨è¾¾å¼æ²¡æœ‰åŒ¹é…åˆ°æ—¶ï¼Œè¿™ä¸€æ¡æ‰ä¼šé‡‡ç”¨è¿™ä¸€æ¡</span></span><br><span class="line">  [ configuration CC ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">location</span> <span class="title">^~ /images</span>/ &#123;</span><br><span class="line">  <span class="comment"># åŒ¹é…ä»»ä½•ä»¥ /images/ å¼€å¤´çš„åœ°å€ï¼ŒåŒ¹é…ç¬¦åˆä»¥åï¼Œåœæ­¢å¾€ä¸‹æœç´¢æ­£åˆ™ï¼Œé‡‡ç”¨è¿™ä¸€æ¡ã€‚</span></span><br><span class="line">  [ configuration D ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">location</span> <span class="title">~* \.(gif</span>|jpg|jpeg)$ &#123;</span><br><span class="line">  <span class="comment"># åŒ¹é…æ‰€æœ‰ä»¥ gif,jpgæˆ–jpeg ç»“å°¾çš„è¯·æ±‚</span></span><br><span class="line">  <span class="comment"># ç„¶è€Œï¼Œæ‰€æœ‰è¯·æ±‚ /images/ ä¸‹çš„å›¾ç‰‡ä¼šè¢« config D å¤„ç†ï¼Œå› ä¸º ^~ åˆ°è¾¾ä¸äº†è¿™ä¸€æ¡æ­£åˆ™</span></span><br><span class="line">  [ configuration E ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">location</span> <span class="title">/images</span>/ &#123;</span><br><span class="line">  <span class="comment"># å­—ç¬¦åŒ¹é…åˆ° /images/ï¼Œç»§ç»­å¾€ä¸‹ï¼Œä¼šå‘ç° ^~ å­˜åœ¨</span></span><br><span class="line">  [ configuration F ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">location</span> <span class="title">/images</span>/abc &#123;</span><br><span class="line">  <span class="comment"># æœ€é•¿å­—ç¬¦åŒ¹é…åˆ° /images/abcï¼Œç»§ç»­å¾€ä¸‹ï¼Œä¼šå‘ç° ^~ å­˜åœ¨</span></span><br><span class="line">  <span class="comment"># Fä¸Gçš„æ”¾ç½®é¡ºåºæ˜¯æ²¡æœ‰å…³ç³»çš„</span></span><br><span class="line">  [ configuration G ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">location</span> <span class="title">~ /images</span>/abc/ &#123;</span><br><span class="line">  <span class="comment"># åªæœ‰å»æ‰ config D æ‰æœ‰æ•ˆï¼šå…ˆæœ€é•¿åŒ¹é… config G å¼€å¤´çš„åœ°å€ï¼Œç»§ç»­å¾€ä¸‹æœç´¢ï¼ŒåŒ¹é…åˆ°è¿™ä¸€æ¡æ­£åˆ™ï¼Œé‡‡ç”¨</span></span><br><span class="line">    [ configuration H ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åŒ¹é…çš„ä¼˜å…ˆçº§ï¼š</p><p>(location =) &gt; (location å®Œæ•´è·¯å¾„) &gt; (location ^~ è·¯å¾„) &gt; (location ~,~* æ­£åˆ™é¡ºåº) &gt; (location éƒ¨åˆ†èµ·å§‹è·¯å¾„) &gt; (/)</p><p>æŒ‰ç…§ä¸Šé¢çš„locationå†™æ³•ï¼Œä»¥ä¸‹çš„åŒ¹é…ç¤ºä¾‹æˆç«‹ï¼š</p><ul><li><p>/ -&gt; config A ç²¾ç¡®å®Œå…¨åŒ¹é…ï¼Œå³ä½¿/index.htmlä¹ŸåŒ¹é…ä¸äº†ã€‚</p></li><li><p>/downloads/download.html -&gt; config B åŒ¹é…Bä»¥åï¼Œå¾€ä¸‹æ²¡æœ‰ä»»ä½•åŒ¹é…ï¼Œé‡‡ç”¨Bã€‚</p></li><li><p>/images/1.gif -&gt; configuration D åŒ¹é…åˆ°Fï¼Œå¾€ä¸‹åŒ¹é…åˆ°Dï¼Œåœæ­¢å¾€ä¸‹ã€‚</p></li><li><p>/images/abc/def -&gt; config D æœ€é•¿åŒ¹é…åˆ°Gï¼Œå¾€ä¸‹åŒ¹é…Dï¼Œåœæ­¢å¾€ä¸‹ã€‚ ä½ å¯ä»¥çœ‹åˆ° ä»»ä½•ä»¥/images/å¼€å¤´çš„éƒ½ä¼šåŒ¹é…åˆ°Då¹¶åœæ­¢ï¼ŒFGå†™åœ¨è¿™é‡Œæ˜¯æ²¡æœ‰ä»»ä½•æ„ä¹‰çš„ï¼ŒHæ˜¯æ°¸è¿œè½®ä¸åˆ°çš„ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†è¯´æ˜åŒ¹é…é¡ºåº</p></li><li><p>/documents/document.html -&gt; config C åŒ¹é…åˆ°Cï¼Œå¾€ä¸‹æ²¡æœ‰ä»»ä½•åŒ¹é…ï¼Œé‡‡ç”¨Cã€‚</p></li><li><p>/documents/1.jpg -&gt; configuration E åŒ¹é…åˆ°Cï¼Œå¾€ä¸‹æ­£åˆ™åŒ¹é…åˆ°Eã€‚</p></li><li><p>/documents/Abc.jpg -&gt; config CC æœ€é•¿åŒ¹é…åˆ°Cï¼Œå¾€ä¸‹æ­£åˆ™é¡ºåºåŒ¹é…åˆ°CCï¼Œä¸ä¼šå¾€ä¸‹åˆ°Eã€‚</p></li></ul><blockquote><p>å‚è€ƒè‡ªï¼š <a href="http://seanlook.com/2015/05/17/nginx-location-rewrite/" target="_blank" rel="noopener">seanlookâ€™s blog</a></p></blockquote><h3 id="root"><a href="#root" class="headerlink" title="root"></a>root</h3><p>rootç”¨äºé…ç½®æ ¹ç›®å½•ï¼Œæ¯”å¦‚æœ‰å¦‚ä¸‹locationé…ç½®ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /data/ &#123;</span><br><span class="line">   <span class="attribute">root</span> /locationtest1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å½“locationå—æ¥æ”¶åˆ°<code>/data/index.html</code>çš„è¯·æ±‚åï¼Œå°†åœ¨<code>/locationtest1/data/</code>ç›®å½•ä¸‹æ‰¾åˆ°index.htmlã€‚</p><p>è¯¥æŒ‡ä»¤å¯åœ¨httpï¼Œserveræˆ–locationå—ä¸­é…ç½®ã€‚</p><h3 id="alias"><a href="#alias" class="headerlink" title="alias"></a>alias</h3><p>aliasç”¨äºæ”¹å˜locationæ¥æ”¶åˆ°çš„URIè¯·æ±‚è·¯å¾„ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> <span class="regexp">~ ^/data/(.+\.html)$</span> &#123;</span><br><span class="line">   <span class="attribute">alias</span> /locationtest1/other/<span class="variable">$1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å½“locationå—æ¥æ”¶åˆ°<code>/data/index.html</code>çš„è¯·æ±‚åï¼Œé€šè¿‡aliasï¼ŒNginxåˆ°<code>/locationtest1/other/</code>ç›®å½•ä¸‹æœå¯»index.htmlã€‚ç›¸å½“äºè¯·æ±‚ä»<code>/data/index.html</code>æ›´æ”¹ä¸ºäº†<code>/locationtest1/other/index.html</code>ã€‚</p><h3 id="index"><a href="#index" class="headerlink" title="index"></a>index</h3><p>indexç”¨äºè®¾ç½®ç½‘ç«™çš„é»˜è®¤é¦–é¡µã€‚æ¯”å¦‚ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> <span class="regexp">~ ^/data/(.+)/web/</span> $ &#123;</span><br><span class="line">   <span class="attribute">index</span> index.<span class="variable">$1</span>.html index.html myindex.html</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å½“è¯·æ±‚ä¸º/data/locationtest1/web/æ—¶ï¼ŒNginxä¾æ¬¡æœå¯»index.locationtest1.htmlã€index.htmlå’Œmyindex.htmlé¡µé¢ï¼Œå…ˆæ‰¾åˆ°å“ªä¸ªå°±ç”¨å“ªä¸ªã€‚</p><h3 id="error-page"><a href="#error-page" class="headerlink" title="error_page"></a>error_page</h3><p>è¯¥æŒ‡ä»¤ç”¨äºè®¾ç½®ç½‘ç«™çš„é”™è¯¯é¡µé¢ã€‚è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">error_page</span> code ... [=[response]] uri</span><br></pre></td></tr></table></figure><p></p><ul><li><p><code>code</code>ï¼Œè¦å¤„ç†çš„HTTPé”™è¯¯ç ã€‚</p></li><li><p><code>response</code>ï¼Œå¯é€‰é¡¹ï¼Œå°†codeæŒ‡å®šçš„é”™è¯¯ç è½¬åŒ–ä¸ºæ–°çš„é”™è¯¯ä»£ç responseã€‚</p></li><li><p><code>uri</code>ï¼Œé”™è¯¯é¡µé¢çš„è·¯å¾„æˆ–è€…ç½‘ç«™åœ°å€ã€‚</p></li></ul><p>æ¯”å¦‚ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">error_page</span> <span class="number">404</span> /<span class="number">404</span>.html;</span><br></pre></td></tr></table></figure><p></p><p>Nginxä½¿ç”¨<code>Nginxå®‰è£…ç›®å½•/html/404.html</code>é¡µé¢å“åº”404é”™è¯¯ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">error_page</span> <span class="number">403</span> http://somewebsite.com/forbidden.html;</span><br></pre></td></tr></table></figure><p></p><p>Nginxä½¿ç”¨<code>http://somewebsite.com/forbidden.html</code>é¡µé¢å“åº”403é”™è¯¯ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">error_page</span> <span class="number">410</span> =<span class="number">301</span> /empty.gif;</span><br></pre></td></tr></table></figure><p></p><p>NginxæœåŠ¡å™¨äº§ç”Ÿ410çš„HTTPæ¶ˆæ¯æ—¶ï¼Œä½¿ç”¨<code>Nginxå®‰è£…ç›®å½•/html/empty.gif</code>è¿”å›ç»™ç”¨æˆ·ï¼ŒHTTPçš„çŠ¶æ€ç ä¸º301ã€‚</p><p>åŠ å…¥æƒ³è¦æ”¹å˜<code>Nginxå®‰è£…ç›®å½•/html/</code>è¿™ä¸ªé»˜è®¤çš„è·¯å¾„ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªlocaitonå—ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /<span class="number">404</span>.html &#123;</span><br><span class="line">   <span class="attribute">root</span> /myserver/errorpages/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¯¥æŒ‡ä»¤å¯åœ¨httpï¼Œserverå’Œlocationå—ä¸­é…ç½®ã€‚</p><h3 id="åŸºäºIPé…ç½®Nginxè®¿é—®æƒé™"><a href="#åŸºäºIPé…ç½®Nginxè®¿é—®æƒé™" class="headerlink" title="åŸºäºIPé…ç½®Nginxè®¿é—®æƒé™"></a>åŸºäºIPé…ç½®Nginxè®¿é—®æƒé™</h3><p>allowæŒ‡ä»¤ç”¨äºé…ç½®å…è®¸è®¿é—®Nginxçš„å®¢æˆ·ç«¯IPï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">allow</span> address | CIDR | all</span><br></pre></td></tr></table></figure><p></p><ul><li><p><code>address</code>ï¼ŒæŒ‡å®šå…è®¸è®¿é—®çš„IPï¼Œä¸æ”¯æŒå¤šä¸ªå€¼ï¼Œå¦‚éœ€è¦æœ‰å¤šä¸ªIPè®¾ç½®ï¼Œéœ€è¦é‡å¤ä½¿ç”¨allowå‘½ä»¤ã€‚</p></li><li><p><code>CIDR</code>ï¼Œå…è®¸è®¿é—®çš„å®¢æˆ·ç«¯çš„CIDRåœ°å€ã€‚</p></li><li><p><code>all</code>ï¼Œä»£è¡¨å…è®¸æ‰€æœ‰çš„å®¢æˆ·ç«¯è®¿é—®ã€‚</p></li></ul><p>denyæŒ‡ä»¤ç”¨äºé…ç½®ç¦æ­¢è®¿é—®Nginxçš„å®¢æˆ·ç«¯IPï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">deny</span> address | CIDR | all</span><br></pre></td></tr></table></figure><p></p><p>è¿™ä¸¤ä¸ªæŒ‡ä»¤å¯åœ¨httpï¼Œserverå’Œlocationå—ä¸­é…ç½®ã€‚</p><h3 id="é…ç½®Nginxå¯†ç "><a href="#é…ç½®Nginxå¯†ç " class="headerlink" title="é…ç½®Nginxå¯†ç "></a>é…ç½®Nginxå¯†ç </h3><p>auth_basicæŒ‡ä»¤ç”¨äºå¼€å¯æˆ–è€…å…³é—­è®¤è¯åŠŸèƒ½ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">auth_basic</span> string | <span class="literal">off</span></span><br></pre></td></tr></table></figure><p></p><ul><li><p><code>stirng</code>ï¼Œå¼€å¯è®¤è¯åŠŸèƒ½ï¼Œå¹¶é…ç½®äº†éªŒè¯æ—¶çš„ä¿¡æ¯ã€‚</p></li><li><p><code>off</code>ï¼Œå…³é—­è®¤è¯ã€‚</p></li></ul><p>auth_basic_user_fileæŒ‡ä»¤æŒ‡å®šäº†åŒ…å«ç”¨æˆ·åå’Œå¯†ç çš„ä¿¡æ¯æ–‡ä»¶è·¯å¾„ï¼Œè¯­æ³•ç»“æ„ä¸ºï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">auth_basic_user_file</span> file</span><br></pre></td></tr></table></figure><p></p><p>å¦‚ï¼Œåœ¨nignx.confé‡Œé…ç½®å¦‚ä¸‹ï¼š</p><p><img src="img/mrbird_pohto_20171101114239.png" alt="mrbird_photo_20171101112512"></p><p>ç”Ÿäº§htpasswdæ–‡ä»¶ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># printf "mrbird:$(openssl passwd -crypt 123456)\n" &gt;&gt;conf/htpasswd</span></span><br><span class="line"><span class="comment"># cat conf/htpasswd</span></span><br><span class="line">mrbird:vdV.OwMSzfJrQ</span><br></pre></td></tr></table></figure><p></p><p>é‡å¯Nginxåï¼Œè®¿é—®<a href="http://localhost/index.html" target="_blank" rel="noopener">http://localhost/index.html</a>ï¼Œé¡µé¢æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p><p><img src="img/mrbird_photo_20171101112838.png" alt="mrbird_photo_20171101112838"></p><h2 id="é…ç½®å®ä¾‹"><a href="#é…ç½®å®ä¾‹" class="headerlink" title="é…ç½®å®ä¾‹"></a>é…ç½®å®ä¾‹</h2><p>å°†conf/nginx.confé…ç½®æˆå¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">error_log</span>  logs/error.log;</span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">log_format</span>  main  <span class="string">'<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] "<span class="variable">$request</span>" '</span></span><br><span class="line">                       <span class="string">'<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> "<span class="variable">$http_referer</span>" '</span></span><br><span class="line">                       <span class="string">'"<span class="variable">$http_user_agent</span>" "<span class="variable">$http_x_forwarded_for</span>"'</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line">    <span class="comment"># é…ç½®server1</span></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">8081</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  localhost;</span><br><span class="line">        </span><br><span class="line">        <span class="attribute">charset</span> utf-<span class="number">8</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="attribute">access_log</span>  /myweb/server1/log/access.log  main;</span><br><span class="line">        </span><br><span class="line">        <span class="attribute">error_page</span>  <span class="number">404</span> /myweb/error/<span class="number">404</span>.html;</span><br><span class="line">        <span class="comment"># é…ç½®/server1/location1/è¯·æ±‚çš„location</span></span><br><span class="line">        <span class="attribute">location</span> /server1/location1 &#123;</span><br><span class="line">            <span class="attribute">root</span>   /myweb;</span><br><span class="line">            <span class="attribute">index</span>  index.html;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># é…ç½®/server1/location2è¯·æ±‚çš„location</span></span><br><span class="line">        <span class="attribute">location</span> /server1/location2 &#123;</span><br><span class="line">            <span class="attribute">root</span>   /myweb;</span><br><span class="line">            <span class="attribute">index</span>  index.html;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># é…ç½®server2</span></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">8082</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  <span class="number">192.168.112.130</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="attribute">charset</span> utf-<span class="number">8</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="attribute">access_log</span>  /myweb/server2/log/access.log  main;</span><br><span class="line">        </span><br><span class="line">        <span class="attribute">error_page</span>  <span class="number">404</span> /<span class="number">404</span>.html;</span><br><span class="line">        <span class="comment"># é…ç½®/server2/location1/è¯·æ±‚çš„locaiton</span></span><br><span class="line">        <span class="attribute">location</span> /server2/location1 &#123;</span><br><span class="line">            <span class="attribute">root</span>   /myweb;</span><br><span class="line">            <span class="attribute">index</span>  index.html;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># é…ç½®/server2/location2/è¯·æ±‚çš„location</span></span><br><span class="line">        <span class="attribute">location</span> /svr2/loc2 &#123;</span><br><span class="line">            <span class="attribute">alias</span>   /myweb/server2/location2; <span class="comment"># å¯¹locationçš„uriè¿›è¡Œæ›´æ”¹</span></span><br><span class="line">            <span class="attribute">index</span>  index.html;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># é‡å®šå‘404é¡µé¢åœ°å€</span></span><br><span class="line">        <span class="attribute">location</span> = /<span class="number">404</span>.html &#123;</span><br><span class="line">            <span class="attribute">root</span> /myweb/error;</span><br><span class="line">            <span class="attribute">index</span> <span class="number">404</span>.html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ„å»ºä¸€ä¸ªé™æ€ç½‘ç«™ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/myweb/</span><br><span class="line">â”œâ”€â”€ error</span><br><span class="line">â”‚Â Â  â””â”€â”€ 404.html</span><br><span class="line">â”œâ”€â”€ server1</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ location1</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ index.html</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ location2</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ index.html</span><br><span class="line">â”‚Â Â  â””â”€â”€ log</span><br><span class="line">â”‚Â Â      â””â”€â”€ access.log</span><br><span class="line">â””â”€â”€ server2</span><br><span class="line">    â”œâ”€â”€ location1</span><br><span class="line">    â”‚Â Â  â””â”€â”€ index.html</span><br><span class="line">    â”œâ”€â”€ location2</span><br><span class="line">    â”‚Â Â  â””â”€â”€ index.html</span><br><span class="line">    â””â”€â”€ log</span><br><span class="line">        â””â”€â”€ access.log</span><br></pre></td></tr></table></figure><p></p><p>å¯åŠ¨NginxæœåŠ¡ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /nginx/sbin/nginx -t</span></span><br><span class="line">nginx: the configuration file /nginx/conf/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /nginx/conf/nginx.conf test is successful</span><br><span class="line"><span class="comment"># /nginx/sbin/nginx</span></span><br></pre></td></tr></table></figure><p></p><p>è®¿é—®<a href="http://localhost:8081/server1/location1/" target="_blank" rel="noopener">http://localhost:8081/server1/location1/</a>ï¼š</p><p><img src="img/mrbird_photo_20171101151244.png" alt="mrbird_photo_20171101151244.png"></p><p>è®¿é—®<a href="http://localhost:8081/server1/location2/" target="_blank" rel="noopener">http://localhost:8081/server1/location2/</a>ï¼š</p><p><img src="img/QQæˆªå›¾20171101151332.png" alt="QQæˆªå›¾20171101151332.png"></p><p>è®¿é—®<a href="http://192.168.112.130:8082/server2/location1/" target="_blank" rel="noopener">http://192.168.112.130:8082/server2/location1/</a>ï¼š</p><p><img src="img/QQæˆªå›¾20171101151521.png" alt="QQæˆªå›¾20171101151521.png"></p><p>è®¿é—®<a href="http://192.168.112.130:8082/svr2/loc2/" target="_blank" rel="noopener">http://192.168.112.130:8082/svr2/loc2/</a>ï¼š</p><p><img src="img/QQæˆªå›¾20171101151607.png" alt="QQæˆªå›¾20171101151607.png"></p><p>è®¿é—®<a href="http://192.168.112.130:8082/svr2/loc3/" target="_blank" rel="noopener">http://192.168.112.130:8082/svr2/loc3/</a>ï¼š</p><p><img src="img/QQæˆªå›¾20171101151711.png" alt="QQæˆªå›¾20171101151711.png"></p><p>ç»“æœè¯æ˜ï¼Œä¸Šè¿°é…ç½®æ­£ç¡®ã€‚</p><script>$(".post-body a").not(".thispage").addClass("ignore-href").attr("target","_blank")</script></div><div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center;color:#878787"><div>è¯·ä½œè€…å–ç“¶è‚¥å®…æ°´~</div><button id="rewardButton" style="margin-top:10px" disable="enable" onclick='var e=document.getElementById("QR");"none"===e.style.display?e.style.display="block":e.style.display="none"'><span style="height:46px;width:46px;line-height:46px;border-radius:50%;color:#fe5f55;font-weight:600;background:#ffd5be;border:none;box-shadow:0 4px 8px 0 rgba(255,213,190,.4)">ï¿¥</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"><img id="wechat_qr" src="/img/wechat_pay.png" alt="MrBird WeChat Pay"></div><div id="alipay" style="display:inline-block"><img id="alipay_qr" src="/img/ali_pay.png" alt="MrBird Alipay"></div></div></div><style>#QR img{width:auto;margin:.8em 1em 0 1em}</style></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>æœ¬æ–‡ä½œè€…ï¼š</strong> MrBird</li><li class="post-copyright-link"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong> <a href="http://mrbird.cc/Nginx basic config.html" title="Nginxçš„åŸºæœ¬é…ç½®">http://mrbird.cc/Nginx basic config.html</a></li><li class="post-copyright-license"><strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</li></ul></div><footer class="post-footer"><div class="post-tags" style="margin-bottom:1.3rem"><a href="/tags/Nginx/" rel="tag"># Nginx</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/Nginx install deploy.html" rel="next" title="Nginxå®‰è£…ä¸éƒ¨ç½²"><i class="fa fa-chevron-left"></i> Nginxå®‰è£…ä¸éƒ¨ç½²</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/Nginx-Gzipå‹ç¼©.html" rel="prev" title="Nginx Gzipå‹ç¼©">Nginx Gzipå‹ç¼© <i class="fa fa-chevron-right"></i></a></div></div></footer></article><hr><div id="container"></div><div class="post-spread"><div id="comment-div"></div><style>.valine .vlist{margin-bottom:3rem}.valine .vwrap .vcontrol .col.col-60{text-align:left}.valine .vlist .vcard .vhead,.valine .vlist .vcard section .vfooter{text-align:left}.valine .vlist .vcard section{padding-bottom:.5rem!important}.vname{color:#42b983!important}.valine .vinfo .col{text-align:left;margin-left:-27rem}div#comment-div{margin-bottom:-8rem}.valine .vlist .vcard .vcontent .code,.valine .vlist .vcard .vcontent code,.valine .vlist .vcard .vcontent pre{background:#fbfbfb}.valine .vlist .vcard .vcontent a{color:#42b983}.valine .vlist .vcard .vimg{border-radius:3px}.valine .vbtn{border-radius:2px;padding:.3rem 1.25rem}.valine .vbtn:active,.valine .vbtn:hover{color:#42b983;border-color:#42b983;background-color:#fff}.valine .vwrap .vheader .vinput:focus{border-bottom-color:#42b983}.valine .vlist .vcard .vcontent.expand:before{background:-webkit-gradient(linear,left top,left bottom,from(hsla(0,0%,100%,0)),to(hsla(0,0%,100%,.2)));background:linear-gradient(180deg,hsla(0,0%,100%,0),hsla(0,0%,100%,.2))}.valine .vlist .vcard .vcontent.expand:after{content:"ç‚¹å‡»å±•å¼€";font-size:.4rem;text-align:right;left:-1rem;background:hsla(0,0%,100%,.2)}.valine .vlist .vcard section .vfooter .vat{color:#b3b3b3}.valine .vlist .vcard section .vfooter .vat:hover{color:#42b983}.vcontent img{margin:0}.valine .info{display:none}</style><script type="text/javascript" src="/js/av.min.js"></script><script type="text/javascript" src="/js/Valine.min.js"></script><script>new Valine({el:"#comment-div",notify:!0,verify:!0,appId:"SMcDFP1bN1jgb9Lo8JmtICHm-gzGzoHsz",appKey:"dH4nrUrt3V5XiJiI6Qyejnbi",placeholder:"",path:window.location.pathname,avatar:"monsterid",guest_info:["nick","mail","link"]})</script></div></div><script>var $bqinline=$("img[alt='bq-inline']");$bqinline.css({width:"2.3rem",height:"2.3rem",display:"inline","vertical-align":"text-bottom"})</script></div><div class="comments" id="comments"></div></div><aside id="sidebar" class="sidebar" onselectstart="return!1"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">Contents</li><li class="sidebar-nav-overview" data-target="site-overview">Site Preview</li></ul><section class="site-overview sidebar-panel"><div class="sidebar-sticky sticky"><div itemscope itemtype="http://schema.org/Person"><div class="author__avatar"><img src="/images/blogImage.jpg" class="author__avatar" alt="MrBird" itemprop="image"></div><div class="author__content"><h3 class="author__name" itemprop="name">MrBird's Blog</h3><p class="author__bio" itemprop="description">A simple blog, code repository, just keep blogging</p></div><div class="author__urls-wrapper"><button class="btn btn--inverse">Follow</button><ul class="author__urls social-icons"><li><a href="http://map.baidu.com/?newmap=1&s=s%26wd%3D%E7%A6%8F%E5%B7%9E%E5%B8%82%26c%3D300&from=alamap&tpl=mapcity" target="_blank" itemprop="url" class="ignore-href"><i class="fa fa-fw fa-map-marker" aria-hidden="true"></i>&nbsp;&nbsp;FuZhou,CN</a></li><li><a href="https://love.mrbird.cc" target="_blank" itemprop="url" class="ignore-href"><i class="fa fa-fw fa-diamond" aria-hidden="true"></i>&nbsp;&nbsp;Love</a></li><li><a href="http://111.230.157.133/febs" target="_blank" itemprop="url" class="ignore-href"><i class="fa fa-fw fa-chain" aria-hidden="true"></i>&nbsp;&nbsp;Website</a></li><li><a href="/atom.xml" target="_blank" itemprop="url" class="ignore-href"><i class="fa fa-fw fa-rss" aria-hidden="true"></i>&nbsp;&nbsp;RSS</a></li><li><a href="https://gitee.com/github-16661027" target="_blank" itemprop="sameAs" class="ignore-href"><i class="fa fa-fw fa-codepen" aria-hidden="true"></i>&nbsp;&nbsp;Gitee</a></li><li><a href="https://github.com/wuyouzhuguli" target="_blank" itemprop="sameAs" class="ignore-href"><i class="fa fa-fw fa-github-alt" aria-hidden="true"></i>&nbsp;&nbsp;GitHub</a></li><li><a href="javascript:;" class="popup-trigger"><i class="fa fa-fw fa-search" aria-hidden="true"></i>&nbsp;&nbsp;Search</a></li></ul></div></div></div><script>var $urls=$(".author__urls").find("a");$urls.each(function(){var o=$(this);o.mouseenter(function(){o.css({color:"#414547"})}),o.mouseleave(function(){o.css({color:""})})})</script></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#NginxåŸºç¡€é…ç½®æŒ‡ä»¤"><span class="nav-number">1.</span> <span class="nav-text">NginxåŸºç¡€é…ç½®æŒ‡ä»¤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#user"><span class="nav-number">1.1.</span> <span class="nav-text">user</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#worker-processes"><span class="nav-number">1.2.</span> <span class="nav-text">worker_processes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#error-log"><span class="nav-number">1.3.</span> <span class="nav-text">error_log</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pid"><span class="nav-number">1.4.</span> <span class="nav-text">pid</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#worker-rlimit-nofile"><span class="nav-number">1.5.</span> <span class="nav-text">worker_rlimit_nofile</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#worker-connections"><span class="nav-number">1.6.</span> <span class="nav-text">worker_connections</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#include"><span class="nav-number">1.7.</span> <span class="nav-text">include</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#accept-mutex"><span class="nav-number">1.8.</span> <span class="nav-text">accept_mutex</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#multi-accept"><span class="nav-number">1.9.</span> <span class="nav-text">multi_accept</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#use"><span class="nav-number">1.10.</span> <span class="nav-text">use</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#worker-connentions"><span class="nav-number">1.11.</span> <span class="nav-text">worker_connentions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æŒ‡å®šMIME"><span class="nav-number">1.12.</span> <span class="nav-text">æŒ‡å®šMIME</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è‡ªå®šä¹‰æœåŠ¡æ—¥å¿—"><span class="nav-number">1.13.</span> <span class="nav-text">è‡ªå®šä¹‰æœåŠ¡æ—¥å¿—</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sendfile-amp-sendfile-max-chunk"><span class="nav-number">1.14.</span> <span class="nav-text">sendfile &amp; sendfile_max_chunk</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#keepalive-timeout"><span class="nav-number">1.15.</span> <span class="nav-text">keepalive_timeout</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#keepalive-requests"><span class="nav-number">1.16.</span> <span class="nav-text">keepalive_requests</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#listen"><span class="nav-number">1.17.</span> <span class="nav-text">listen</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#server-name"><span class="nav-number">1.18.</span> <span class="nav-text">server_name</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#locationå—"><span class="nav-number">1.19.</span> <span class="nav-text">locationå—</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#root"><span class="nav-number">1.20.</span> <span class="nav-text">root</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#alias"><span class="nav-number">1.21.</span> <span class="nav-text">alias</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#index"><span class="nav-number">1.22.</span> <span class="nav-text">index</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#error-page"><span class="nav-number">1.23.</span> <span class="nav-text">error_page</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åŸºäºIPé…ç½®Nginxè®¿é—®æƒé™"><span class="nav-number">1.24.</span> <span class="nav-text">åŸºäºIPé…ç½®Nginxè®¿é—®æƒé™</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#é…ç½®Nginxå¯†ç "><span class="nav-number">1.25.</span> <span class="nav-text">é…ç½®Nginxå¯†ç </span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#é…ç½®å®ä¾‹"><span class="nav-number">2.</span> <span class="nav-text">é…ç½®å®ä¾‹</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer" onselectstart="return!1"><div class="footer-inner"><div class="copyright">&copy; 2016 - <span itemprop="copyrightYear">2019</span>&nbsp;&nbsp; <span class="author" itemprop="copyrightHolder">MrBird</span>&nbsp;&nbsp;|<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>&nbsp;&nbsp;UV&nbsp;<span class="busuanzi-value" id="busuanzi_value_site_uv" style="cursor:pointer" title="ç»Ÿè®¡å¼€å§‹æ—¶é—´ï¼š2019å¹´7æœˆ5æ—¥"></span> &nbsp;&nbsp;PV&nbsp;<span class="busuanzi-value" id="busuanzi_value_site_pv" style="cursor:pointer" title="ç»Ÿè®¡å¼€å§‹æ—¶é—´ï¼š2019å¹´7æœˆ5æ—¥"></span></div></div></footer><div class="back-to-top"><span style="font-family:'Source Sans Pro','Helvetica Neue',Arial,sans-serif;font-size:1.2em;font-weight:600">TOP</span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":search_path.endsWith("json")&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){function r(e,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===t&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url),d=[],g=[];if(""!=l&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}d=d.concat(e(t,h,!1)),g=g.concat(e(t,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var C=[];0!=g.length;){var $=g[g.length-1],m=$.position,x=$.word,w=m-20,y=m+80;w<0&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),C.push(r(p,w,y,g))}C.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var T=parseInt("1");T>=0&&(C=C.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",C.forEach(function(t){b+="<a href='"+f+'\'><p class="search-result">'+s(p,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){var e=27===t.which&&$(".search-popup").is(":visible");e&&onPopupClose()})</script></body><script>$(function(){$("a").not(".nav-link,.cloud-tie-join-count,.ignore-href,.jstree-anchor").addClass("animsition-link")});var burst1=new mojs.Burst({left:0,top:0,radius:{5:40},children:{shape:"circle",fill:["red","cyan","orange"],fillOpacity:.8,radiusX:3.5,radiusY:3.5}});document.addEventListener("click",function(a){null==a.target.href&&"footer"!=a.target.className&&"copyright"!=a.target.className&&"author__urls social-icons"!=a.target.className&&"author__avatar"!=a.target.className&&"sidebar sidebar-active"!=a.target.className&&burst1.tune({x:a.pageX,y:a.pageY}).generate().replay()})</script><script type="text/javascript" src="/js/message.js"></script></html><!-- rebuild by neat -->